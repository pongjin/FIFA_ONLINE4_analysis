# 피파온라인4 API 활용 분석
기간 : 23.04.19 ~ 23.05.02  
데이터 출처 : NEXON DEVELOPERS 내 피파온라인4 API, 피파인벤 자유게시판

## 주제 : 게임 내 데이터를 통한 플레이 스타일 재정의

**주제 선정 배경: 현재 피파온라인4의 전력분석실에서 제공하는 플레이 스타일의 한계** 
1. 너무 많은 스타일 : 15여 개의 스타일 별 대응 방법을 모두 알 수 없음
2. 특정 포메이션에 편향된 스타일 : CAM LAM RAM 이면 2선 활용, 5백이면 철퇴 축구 등 단순 포메이션을 따름
3. 스타일의 과한 불균형 : 사실상 많이 쓰이는 여러개의 스타일을 제외한다면, 나머지 스타일은 없어도 무방  

**>> 포메이션과는 다른 유저들의 플레이 방식을 찾아보고 싶다.** 
## 분석 요약
#### 구조
```
├── FIFA_ONLINE3_analysis/
   ├── 데이터_수집1.ipynb
   ├── 데이터_수집2_및_최종_전처리.ipynb
   ├── 무작위_매치_데이터_수집.ipynb
   ├── clustering/
     ├──  standard_euc.ipynb
     ├──  standard_cos.ipynb
     ├── standard_mahalanobis.ipynb
     └── pca_euc.ipynb
   ├── ANOVA.ipynb
   └── pca_cos_최종_선정_및_결과테이블.ipynb
```
**분석 대상** 
>1. 2023년 이후 월드클래스 등급 이상 달성
>2. 최근 정상종료 경기 수 20판
>3. 3점 이하의 득실 차 경기

**분석 방법** 
#### EDA-PCA-Clustering-ANOVA
#### 내용
![image](https://velog.velcdn.com/images/pong_jin/post/9cc8c348-dad4-401e-9e45-8c8c4bec2ba1/image.png)
  
2023년 전력분석실 내 지속적으로 업데이트 된 플레이 스타일 정의 문서를 크롤링, 이후 텍스트 마이닝을 통해 워드 클라우드로 주요 요소 추출.  
**공격 / 수비 / 전개 / 위치** 4가지를 키워드로 변수 선정  

![image](https://velog.velcdn.com/images/pong_jin/post/7c65414f-1a26-48c7-b116-a98ecfa002f6/image.png)
  
패스, 슈팅과 같은 단순 횟수는 위와 같이 포메이션의 영향을 받음. 따라서 이를 전체 횟수나 특정 포지션의 선수 수로 나누는 변환을 진행 >> 포메이션에 구애받지 않는 상대적인 지표 생성

이후 PCA, standardized로 변환한 데이터를 3가지 거리 지표(Euclidean, Cosine, mahalanobis), 3가지 군집화(K-means, Agglomerative, Spectral) 결과를 비교하여 최종 군집 선정 및 해석  

**군집(플레이 스타일) 해석**
| 군집 | in_rate | heading | short | long | side | center | defence | samples |
| - | --- | --- | --- | --- | --- | --- | --- | --- |
| 0 | 0.17 | -0.37 | -0.48 | 0.64 | 0.78 | -0.34 | 0.5 | 420 |
| 1 | -0.70 | ... | ... | ... | ... | ... | ... | 341 |
| 2 | 0.35 | ... | ... | ... | ... | ... | ... | 465 |   

**군집 0 (빌드업 축구)** : 짧은 패스 전개를 바탕으로 중앙 및 측면 모두 활용도가 높음.   
**군집 1 (수비 축구)** : 수비 활용도가 높으며 중원과의 짧은 패스를 통해 중거리 슛을 주 득점 루트로 전개. 게임 내 중거리 슛이 크게 상향을 받은 현 시점에 부합하는 전술.  
**군집 2 (선 굵은 축구)** : 짧은 잔 패스를 통해 점유율을 올리기보다 롱패스와 쓰루패스를 통한 다이렉트 패스 전개를 선호. 크로스를 통한 헤딩슛의 비율이 매우 높다.

**단변량 분석**  
기존 포메이션을 6가지로 통일(442, 451, 424, 433, 523, 532) 후 앞서 군집화로 정의한 스타일과 함께 승률에 미치는 영향을 검정하기 위해 two-way ANOVA 진행.  
검정 결과 포메이션과 스타일 두 요인에 따른 집단 간 유의미한 승률의 차이는 없어 게임 내 절대적인 우위를 지닌 집단 없이 게임 운영의 밸런스가 잘 잡혀있다고 볼 수 있음.  

그러나 각 집단 별 상대 승률에서는 유의미한 차이를 확인 할 수 있었음. 
![image](https://velog.velcdn.com/images/pong_jin/post/8df54e27-2d55-49b7-b0c6-103e2346e754/image.png)

**결론**  
같은 포메이션이라도 플레이 스타일에 따른 승률의 차이를 확인할 수 있듯이, 앞서 정의한 플레이 스타일이 전략 분석에 활용 가능한 유의미한 지표로 판단됨.
***
### 아쉬운점
1. 표본 수가 적은 포메이션은 분석을 진행하지 못했다. 
2. 유저의 플레이 스타일이 단 3개로만 나뉘어 이상적이지 못한 결과라고 생각함..  
좀 더 다채로운 스타일을 뽑아내고 싶었지만, 군집화 성능이 매우 낮아 신뢰할 수 없는 결과라고 판단하였음. 
다양한 조합의 변수들을 사용하여 군집화를 진행했다면 새로운 군집이 나오지 않았을까 싶음.  

3. 군집화와 변수 변환에 대한 궁금증을 해결하지 못함.(⭐️⭐️⭐️)  
군집화는 변수 간 scale에 민감해 이를 조절해주지 않으면 특정 변수로 결과가 편향될 수 있음. 그러나 표준화 같은 변환을 한 후 데이터의 산점도를 보면 항상 뭉쳐있는 개형이 확인되어 군집 평가 성능이 저하 되는 사례를 종종 볼 수 있었다.  
![image](https://velog.velcdn.com/images/pong_jin/post/71ce2802-3773-47b2-9063-e826b74bd8e3/image.png)   
이럴땐 어떤 방법을 적용해야 되는지에 대한 추가적인 공부가 필요하다.  

